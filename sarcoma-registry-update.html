<!--
    TODO
        - dynamic open graph and twitter metadata, based on articles and pages
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Franky.Codes</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content=hello world>

        <!-- open graph metadata for facebook/twitter -->

<meta property="og:title" content="A new approach for the BlueBerry registry using vantage6" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://franky.codes/sarcoma-registry-update.html" />
<meta property="og:image" content="/images/sarcoma/cover_1.jpeg" />
<meta property="og:description" content="A new approach for the BlueBerry registry using vantage6" />


        <!-- styles -->
        <link rel="stylesheet" href="https://franky.codes/theme/css/ubuntu-mono.min.css?5329fd52">

        <link rel="stylesheet" href="https://franky.codes/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://franky.codes/theme/css/main.min.css?802a27f9">


        <!-- canonical url of the current page -->
        <link rel="canonical" href="https://franky.codes/sarcoma-registry-update.html" />

        <!-- fav icons -->
        <!-- https://favicon.io/favicon-converter/ -->
        <link rel="apple-touch-icon" sizes="180x180" href="https://franky.codes/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://franky.codes/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://franky.codes/favicon/favicon-16x16.png">
        <link rel="manifest" href="https://franky.codes/favicon/site.webmanifest">

        <link
            href="https://franky.codes/feeds/all.atom.xml"
            type="application/atom+xml" rel="alternate" title="Franky.Codes Atom Feed" />
        <link
            href="https://franky.codes/feeds/all.rss.xml"
            type="application/rss+xml" rel="alternate" title="Franky.Codes RSS Feed" />

    </head>
    <body class="">

        <!-- top navigation -->
        <header>
            <nav class="navigation">
                <i class="fa-solid">
                    <img src="https://franky.codes/favicon/favicon-32x32.png"
                         alt="menu icon"
                         class="menu-icon"
                         width="16"
                         height="16">
                </i>

                <span class="site-name">
                    Franky.Codes
                </span>

                <!-- hamburger menu -->
                <input id="menu-toggle" type="checkbox" />
                <label class='menu-button-container' for="menu-toggle">
                    <span class='menu-button'></span>
                </label>
                <ul class="menu">
                    <li><a href="https://franky.codes" title="Projects">Projects</a></li>
                    <li><a href="https://franky.codes/pages/curriculum-vitae.html" title="Curriculum Vitae">Curriculum Vitae</a></li>
                    <li><a href="https://franky.codes/pages/hire-me.html" title="Hire Me">Hire Me</a></li>
                </ul>
                <ul class="feeds tablet-hidden">
                    <li>
                        <a href="https://franky.codes/feeds/all.atom.xml"
                           type="application/atom+xml"
                           title="Franky.Codes Atom Feed">
                            <i class="fa-solid fa-atom"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://franky.codes/feeds/all.rss.xml"
                           type="application/rss+xml"
                           title="Franky.Codes RSS Feed">
                            <i class="fa-solid fa-rss"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- main content -->
        <main>
            <!-- mini map scroll bar -->
            <canvas id="map"></canvas>
            <div class="wrapper">
                <article class="identity">
                    <img
                        src="https://franky.codes/images/me.jpg"
                        alt="picture of Frank Martin"
                        class="profile-picture">
                    <h1>Frank Martin</h1>
                    <p>Biomedical Engineer &amp; Software Engineer</p>

                    <nav class="social">
                        <a
                            rel="external"
                            href="https://github.com/frankcorneliusmartin"
                            title="My github page">
                            <i class="fa-brands fa-github"></i>
                        </a>
                        <a
                            rel="external"
                            href="https://www.linkedin.com/in/frankcorneliusmartin"
                            title="My linkedin page">
                            <i class="fa-brands fa-linkedin"></i>
                        </a>
                    </nav>
                </article>
                <div id="content" class="content ">
    <!-- TODO: make this a template html element -->
    <div id="template" class="generated-page">
        <div class="page-divider up">
            <span class="line"></span>
            <span class="text">
                <i class="fa-sharp fa-solid fa-circle-up"></i>
                <a href="#">previous page</a>
                <i class="fa-sharp fa-solid fa-circle-up"></i>
            </span>
            <span class="line"></span>
        </div>
        <div class="dynamic-content"></div>
        <div class="page-divider down">
            <span class="line"></span>
            <span class="text">
                <i class="fa-sharp fa-solid fa-circle-down"></i>
                <a href="#">next page</a>
                <i class="fa-sharp fa-solid fa-circle-down"></i>
            </span>
            <span class="line"></span>
        </div>
    </div>
    <div id="hidden-wrapper">
<header>
<h1 class="purple">
    <a href="https://franky.codes/sarcoma-registry-update.html" id="page-title">A new approach for the BlueBerry registry using vantage6</a>
</h1>
</header>
<article>
    <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#local-data-storage" id="toc-entry-1">1&nbsp;&nbsp;&nbsp;Local Data Storage</a></li>
<li><a class="reference internal" href="#researcher-user-interface" id="toc-entry-2">2&nbsp;&nbsp;&nbsp;Researcher User Interface</a></li>
<li><a class="reference internal" href="#future-work" id="toc-entry-3">3&nbsp;&nbsp;&nbsp;Future work</a></li>
</ul>
</div>
<p>The <a class="reference external" href="https://euracan.eu/registries/blueberry/">BlueBerry project</a> was a two-year
initiative to develop a blueprint for a sustainable, scalable, and impactful data
infrastructure for rare cancers in Europe. In the context of
<a class="reference external" href="https://iknl.nl/en/news/blueberry-is-now-really-taking-off!-building-a-blu">IKNL</a>, I
have been involved in extending the <a class="reference external" href="https://vantage6.ai">vantage6</a> software to be
able to connect to <a class="reference external" href="https://www.ohdsi.org/data-standardization/">OMOP data sources</a>.</p>
<p>When the project finished in September 2024, it was decided to continue with the
registry to use it for research. However, several challenges needed to be addressed
before it could be used for research:</p>
<ul class="simple">
<li>The user interface that has been developed for vantage6 lacked the components that
made working with the OMOP data source easy. It still required an engineer to operate
the system.</li>
<li>The computation of the output was rather slow as the original data source was visited
for each computation call. This included creating the cohort and querying the selected
features.</li>
<li>Only <a class="reference external" href="https://github.com/IKNL/v6-crosstab-on-ohdsi-py">Crosstabulation</a> and
<a class="reference external" href="https://github.com/IKNL/v6-kaplan-meier-on-ohdsi-py">Kaplan-Meier curve</a> have been
extended to work in the registry. There were some experiments with the OHDSI tools,
but these were difficult to operate.</li>
</ul>
<p>I was asked to work together with <a class="reference external" href="https://www.biomeris.it/en/">BIOMERIS</a> on
addressing these issues to enable researchers using the platform for gaining meaningful
insights.</p>
<p>In this blog post, I will explain first how I address performance issue as this
influences how the user interface is designed. Then, I will explain how the user
interface is designed to support the workflow of the researcher.</p>
<div class="section" id="local-data-storage">
<h2><a class="toc-backref" href="#toc-entry-1">1&nbsp;&nbsp;&nbsp;Local Data Storage</a></h2>
<p>Typically in vanilla vantage6, the data is fetched from the data source for each
computation call. This made computations slow as the OMOP query was typically time
consuming. To speed up the computations, I decided to fetch the data once for each
cohort and store it local in the vantage6 node.</p>
<div class="uml docutils container">
<pre class="code literal-block">
┌──────────┐   ┌────────────┐   ┌────────────┐
│ OMOP     │   │ Query      │   │ Local DB   │
│ Database ├──►│ Algorithm  ├──►│ Parquet    │
└──────────┘   └────────────┘   └────────────┘
</pre>
</div>
<p>The <tt class="docutils literal">Query Algorithm</tt> is a vantage6 algorithm that is responsible for fetching the
data from the OMOP database. It creates the ATLAS cohort and reads the patient features.
The data is stored by this algorithm in a <a class="reference external" href="https://parquet.apache.org/">Parquet</a> file.
This Parquet file is then used by the other algorithms to perform the analytics.</p>
<div class="uml docutils container">
<pre class="code literal-block">
┌────────────┐   ┌────────────┐   ┌───────────┐
│ Local DB   │   │ vantage6   │   │ Algorithm │
│ Parquet    ├──►│ Algorithm  ├──►│ Output    │
└────────────┘   └────────────┘   └───────────┘
</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the future, I would like to extend the system so that these Parquet files can also be
modified by the user. For example, the user can create new variables.</p>
</div>
<p>There are some challenges with this approach:</p>
<ul class="simple">
<li>When a node is offline when a new cohort is created it will not be able to fetch the
data. In this case, the node will create the cohort data it comes online. The user
can work with the other nodes in the meantime.</li>
<li>When the data source is updated, the Parquet files need to be updated as well. This
is currently a manual process as the user needs to trigger the Query Algorithm to
fetch the data again.</li>
<li>The Parquet files need to have the same variables and the same value types for these
variables. This should be guaranteed by the <tt class="docutils literal">Query Algorithm</tt>. Especially when the
cohorts are not created at the same time (e.g. when a node was offline when it was
created).</li>
</ul>
<p>When a node is offline when a new cohort is created it will not be able to fetch the
data. In this case, the node will create the cohort data it comes online. The user can
work with the other nodes in the meantime.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An additional benefit of this approach is that algorithms do no longer have the
logic to fetch the data from the OMOP database. So the vantage6 community algorithms
can be used without (much) modification.</p>
</div>
</div>
<div class="section" id="researcher-user-interface">
<h2><a class="toc-backref" href="#toc-entry-2">2&nbsp;&nbsp;&nbsp;Researcher User Interface</a></h2>
<p>The official vantage6 User Interface (UI) is developed as a general-purpose vantage6 UI.</p>
<div class="figure align-center">
<img alt="vantage6 user interface" src="https://franky.codes/images/sarcoma/screenshots-v6-ui.png" style="width: 800px;" />
<p class="caption">The official vantage6 user interface from vantage6 (from <a class="reference external" href="https://vantage6.ai">https://vantage6.ai</a>).</p>
</div>
<p>If a new feature is to be added in this interface, it needs to be compatible with other
projects from the community as well. This has two major disadvantages:</p>
<ul class="simple">
<li>It feels overcomplicated for the user as it contains features that are not relevant
for the BlueBerry registry and it is not tailored to the workflow of the researcher.</li>
<li>Adding new features to the UI is time-consuming as it needs to be compatible with
other projects and requires approval from the vantage6 community.</li>
</ul>
<p>For these two reasons, I decided it would be better to create a separate, dedicated UI
for the BlueBerry registry. This way, I can tailor the workflow exactly as it should be
and I don't have to consider other projects when adding new features.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>As the proposed dedicated UI is aimed to support the workflow of the researcher, it
is not going to contain all the features that the official vantage6 UI has. The
official vantage6 UI is still available for the BlueBerry registry. It is possible
to switch between the two UIs.</p>
<p class="last">For instance, the official vantage6 UI is still used for the management of the
collaborations and studies.</p>
</div>
<p>To accelerate development, I used <a class="reference external" href="https://streamlit.io/">Streamlit</a>. This framework
brought the following advantages:</p>
<ul class="simple">
<li>It minimizes the need to write front-end code as the front-end code, as it is
generated from Python code.</li>
<li>It includes numerous built-in data science components like tables, graphs and
controls.</li>
</ul>
<p>However, it introduces an additional backend component, the one that renders the front
end. The app's appearance and components can be customized, however the customization
is very different from front-end frameworks like React or Angular.</p>
<p>This newly developed UI aims to better support the researcher's workflow. The first
thing after logging in is to select the collaboration and optionally the study it wants
to work with. Once the collaboration/study is selected, the user can view the online
organizations within the collaboration or study. The user is at this point able to
create sub selections of the organizations it wants to work with.</p>
<div class="scrollx docutils container">
<table border="1" class="docutils align-center">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Collaboration &amp; Study Selection</th>
<th class="head">Node status</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><div class="first last figure align-center">
<img alt="users can select their collaboration and study" src="https://franky.codes/images/sarcoma/collaboration_and_study.jpeg" style="width: 400px;" />
<p class="caption">Users first need to select the collaboration and optionally the study they
want to work with. Some metadata is shown about the selected collaboration
and study.</p>
</div>
</td>
<td><div class="first last figure align-center">
<img alt="users can check the status of the nodes" src="https://franky.codes/images/sarcoma/node_status_redacted.jpeg" style="width: 400px;" />
<p class="caption">Once the collaboration is selected, the user can view the online
organizations. It is possible to create a sub selection of the organizations
the user wants to work with.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<p>Once the organizations are selected, the system checks which cohorts are available for
the selected organizations. The UI then determines automatically which cohorts are ready
for analysis, it validates that:</p>
<ol class="arabic simple">
<li>All the (online) organizations have the cohort available.</li>
<li>The minimal number of patients threshold is met at each organization.</li>
<li>All the organizations have the same variables and have the same value types for these
variables.</li>
</ol>
<p>By default, all the <em>healthy</em> cohorts are selected. The user can also make a sub
selection of the cohorts it wants to work with. It is also possible to create a new
cohort based on the <a class="reference external" href="https://atlas-demo.ohdsi.org/">ATLAS</a> cohort definitions.</p>
<div class="scrollx docutils container">
<table border="1" class="docutils align-center">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Cohort selection</th>
<th class="head">Cohort creation</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><div class="first last figure align-center">
<img alt="users can select the cohorts they want to work with" src="https://franky.codes/images/sarcoma/healthy_cohorts.jpeg" style="width: 400px;" />
<p class="caption">Users can select the cohorts they want to work with. By default, all the
healthy cohorts are selected. In this case none of the cohorts are healthy.</p>
</div>
</td>
<td><div class="first last figure align-center">
<img alt="users can create a new cohort" src="https://franky.codes/images/sarcoma/healthy_cohorts_2.jpeg" style="width: 400px;" />
<p class="caption">Before the user can continue all the selected organizations need to have the
cohort available. The user is able to select the cohorts and from there
automatically select the organizations that passed the validation.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<p>Once the cohorts have been selected the user can continue to the analytics part of the
application. The first analytics that is available is the summary statistics. This gives
an overview of all selected cohorts and its variables. It reports some basic statistics
like missing, mean, standard deviation, etc.</p>
<p>The second analytics that is available is the crosstabulation. This is a useful tool
to compare the distribution of two categorical variables. The user can select the
variables it wants to compare and the crosstabulation is calculated for all selected
cohorts.</p>
<p>The third analytics that is available is the Kaplan-Meier curve. This is can be used
to compare the survival between cohorts. The dataset contains the survival time and
the event indicator, so these are already preselected.</p>
<div class="scrollx docutils container">
<table border="1" class="docutils align-center">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Summary statistics</th>
<th class="head">Crosstabulation</th>
<th class="head">Kaplan-Meier curve</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><div class="first last figure align-center">
<img alt="users can view the summary statistics of all selected cohorts" src="https://franky.codes/images/sarcoma/summary_stats.jpeg" style="width: 266px;" />
<p class="caption">Users can view the summary statistics of all selected cohorts. The summary
statistics are calculated for all selected cohorts.</p>
</div>
</td>
<td><div class="first last figure align-center">
<img alt="users can compare the distribution of two variables" src="https://franky.codes/images/sarcoma/crosstabs.jpeg" style="width: 266px;" />
<p class="caption">Users can compare the distribution of two variables. The crosstabulation is
calculated for all selected cohorts.</p>
</div>
</td>
<td><div class="first last figure align-center">
<img alt="users can compare the survival of two cohorts" src="https://franky.codes/images/sarcoma/kaplan_meier.jpeg" style="width: 266px;" />
<p class="caption">Users can compare the survival of two cohorts. The Kaplan-Meier curve is
calculated for all selected cohorts.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="future-work">
<h2><a class="toc-backref" href="#toc-entry-3">3&nbsp;&nbsp;&nbsp;Future work</a></h2>
<p>This project is still in development throughout 2025. There are still several features
that need to be added to the system. The following features are planned:</p>
<ol class="arabic simple">
<li>The current algorithms need to be extended to support additional features like
stratification.</li>
<li>Currently in development are some more advanced analytics like the Cox proportional
hazard model and the propensity score matching.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In the future the <a class="reference internal" href="#local-data-storage">Local Data Storage</a> will be no longer be necessary as this
feature will be build into the vantage6 core (This feature is called sessions and
is available from <a class="reference external" href="https://github.com/vantage6/vantage6/issues/943">version 5+</a>).</p>
<p class="last">This might be added to the final stages of the project.</p>
</div>
</div>

</article>

<p id="post-share-links" class="social call-out">

    <span class="share-label">Share this post</span>

    <a href="mailto:?subject=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6&amp;body=https%3A//franky.codes/sarcoma-registry-update.html" title="Share via Email">
        <i class="fa fa-envelope"></i>
    </a>

    <a href="https://sharetodiaspora.github.io/?title=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6&url=https%3A//franky.codes/sarcoma-registry-update.html" title="Share on Diaspora">
        <i class="fa-brands fa-diaspora"></i>
    </a>

    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//franky.codes/sarcoma-registry-update.html" title="Share on Facebook">
        <i class="fa-brands fa-facebook"></i>
    </a>

    <a href="https://news.ycombinator.com/submitlink?t=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6&u=https%3A//franky.codes/sarcoma-registry-update.html" title="Share on Hacker News">
        <i class="fa-brands fa-hacker-news"></i>
    </a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//franky.codes/sarcoma-registry-update.html&title=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6&summary=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6&source=https%3A//franky.codes/sarcoma-registry-update.html" title="Share on LinkedIn">
        <i class="fa-brands fa-linkedin"></i>
    </a>

    <a href="https://toot.kytta.dev/?text=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6%0D%0Ahttps%3A//franky.codes/sarcoma-registry-update.html%0D%0A%23python %23vantage6 %23OHDSI %23streamlit" title="Share on Mastodon">
        <i class="fa-brands fa-mastodon"></i>
    </a>

    <a href="https://www.reddit.com/submit?url=https%3A//franky.codes/sarcoma-registry-update.html&title=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6" title="Share via Reddit">
        <i class="fa-brands fa-reddit"></i>
    </a>

    <a href="https://twitter.com/intent/tweet?text=A%20new%20approach%20for%20the%20BlueBerry%20registry%20using%20vantage6&url=https%3A//franky.codes/sarcoma-registry-update.html&hashtags=python,vantage6,ohdsi,streamlit" title="Share on Twitter">
        <i class="fa-brands fa-twitter"></i>
    </a>

</p>    </div>
                </div>
            </div>
        </main>
        <footer>
            <div class="inner">
                <div class="column align-left">
                    <a
                        href="https://github.com/pelican-themes/atom"
                        title="Source code of this Pelican theme">
                        <i class="fa-brands fa-github"></i>
                        Atom theme
                    </a>
                </div>
                <div class="column">
                    <i class="fa-solid fa-copyright"></i>
                    2025 <span class="mobile-hidden">Franky.Codes</span>
                </div>
            </div>
        </footer>

        <!-- Javascript -->
        <script type="text/javascript" src="https://franky.codes/theme/javascript/pagemap-1.4.0.js"></script>
        <script type="text/javascript" src="https://franky.codes/theme/javascript/main.js"></script>
        <!-- todo minify -->

    </body>
</html>